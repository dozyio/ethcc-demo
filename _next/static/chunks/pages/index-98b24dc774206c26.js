(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{858:(e,a,i)=>{"use strict";i.r(a),i.d(a,{default:()=>J});var t=i(7876),r=i(7328),n=i.n(r),l=i(4232),o=i(3573),s=i(5722),u=i(4453),c=i(4194),d=i(6858),g=i(6523),h=i(2931),m=i(2131),p=i(4890),f=i(9792),y=i(7757),b=i(735),w=i(2383),v=i(8195),k=i(6458),x=i(9536),S=i(4294),j=i(2277),C=i(7065),P=i(4502),M=i(3123),B=i(1555),W=i(5247),E=i(9051),F=i(5563),A=i(6135),D=i(7233),z=i(4562),T=i(8635),L=i(6844),G=i(6060),q=i(9737),I=i(9593);let R=["abandoned","able","absolute","academic","acceptable","acclaimed","accomplished","accurate","ace","aching","acidic","acrobatic","active","actual","adept","admirable","admired","adolescent","adorable","adored","advanced","adventurous","affectionate","afraid","african","aged","aggravating","aggressive","agile","agitated","agonizing","agreeable","ajar","alarmed","alarming","alert","alienated","alive","all","altruistic","amazing","ambitious","american","ample","amused","amusing","anchored","ancient","angelic","angry","anguished","animated","annual","another","antique","anxious","any","apprehensive","appropriate","apt","arabian","arctic","arid","aromatic","artistic","ashamed","assured","astonishing","astounding","athletic","attached","attentive","attractive","austere","authentic","authorized","automatic","avaricious","average","aware","awesome","awful","awkward","babyish","back","bad","badass","baggy","bald","bali","bare","barren","basic","beautiful","bedazzling","belated","beloved","beneficial","best","better","bewitched","big","biodegradable","bitter","black","bland","blank","blaring","bleak","blind","blissful","blond","blue","blushing","bogus","boiling","bold","bony","boring","bossy","both","bouncy","bountiful","bowed","box","brave","breakable","breathtaking","brief","bright","brilliant","brisk","broken","bronze","brown","bruised","bubbly","bulky","bumpy","buoyant","burdensome","burly","bustling","busy","buttery","buzzing","calculating","calm","candid","canine","capital","carefree","careful","careless","caring","cautious","cavernous","celebrated","charming","cheap","cheerful","cheery","chief","chilly","chubby","circular","classic","classy","clean","clear","clever","close","closed","cloudy","clueless","clumsy","cluttered","coarse","cold","colorful","colorless","colossal","comfortable","common","compassionate","competent","complete","complex","complicated","composed","concerned","concrete","confused","conscious","considerate","constant","content","conventional","cooked","cool","cooperative","coordinated","corny","corrupt","costly","courageous","courteous","crafty","crazy","creamy","creative","creepy","criminal","crisp","critical","crooked","crowded","cruel","crushing","cuddly","cultivated","cultured","cumbersome","curly","curvy","cute","cylindrical","damaged","damp","dandy","dangerous","dapper","daring","dark","darling","dazzling","dead","deadly","deafening","dear","dearest","decent","decimal","decisive","deep","defenseless","defensive","defiant","deficient","definite","definitive","delayed","delectable","delicious","delightful","delirious","demanding","dense","dental","dependable","dependent","descriptive","deserted","detailed","determined","devoted","different","difficult","digital","diligent","dim","dimpled","dimwitted","direct","dirty","disastrous","discrete","disfigured","disguised","disgusting","dishonest","disloyal","dismal","distant","distinct","distorted","divine","dizzy","doozie","dopey","doting","double","downright","drab","drafty","dramatic","dreary","droopy","dry","dual","dull","dutiful","each","eager","early","earnest","easy","ecstatic","edible","educated","elaborate","elastic","elated","elderly","electric","elegant","elementary","elliptical","embarrassed","embellished","eminent","emotional","empty","enchanted","enchanting","energetic","enlightened","enormous","enraged","entire","envious","epic","equal","equatorial","essential","esteemed","ethical","euphoric","even","evergreen","everlasting","every","evil","exalted","excellent","exceptional","excitable","excited","exciting","exemplary","exhausted","exotic","expensive","experienced","expert","exquisite","extraneous","extraordinary","extroverted","fabulous","failing","faint","fair","faithful","fake","false","familiar","famous","fancy","fantabulous","fantastic","far","faraway","fast","fat","fatal","fatherly","favorable","favorite","fearful","fearless","feisty","feline","female","feminine","few","fickle","filthy","fine","finest","finished","firm","first","firsthand","fitting","fixed","flaky","flamboyant","flashy","flat","flawed","flawless","flickering","flimsy","flippant","flowery","fluffy","fluid","flustered","focused","fond","foolhardy","foolish","forceful","forked","formal","forsaken","forthright","fortunate","fragrant","frail","frank","frayed","free","french","frequent","fresh","friendly","frightened","frightening","frigid","frilly","frivolous","frizzy","front","frosty","frozen","frugal","fruitful","full","fumbling","functional","funkadelic","funny","fussy","fuzzy","gargantuan","gaseous","general","generous","gentle","genuine","geometric","giant","giddy","gifted","gigantic","giving","glamorous","glaring","glass","gleaming","gleeful","glistening","glittering","gloomy","glorious","glossy","glum","gnarly","golden","good","gorgeous","graceful","gracious","grand","grandiose","granular","grateful","grave","gray","great","greedy","green","gregarious","grim","grimy","gripping","grizzled","groovy","gross","grotesque","grouchy","groundbreaking","grounded","growing","growling","grown","grubby","gruesome","grumpy","guilty","gullible","gummy","hairy","half","handmade","handsome","handy","happy","hard","harmful","harmless","harmonious","harsh","hasty","hateful","haunting","healthy","heartfelt","hearty","heavenly","heavy","hefty","helpful","helpless","hidden","hideous","high","hilarious","hoarse","hollow","homely","honest","honorable","honored","hopeful","horrible","hospitable","hot","huge","humble","humiliating","humming","humongous","hungry","hurtful","husky","icky","icy","ideal","idealistic","identical","idiotic","idle","idolized","ignorant","ill","illegal","illiterate","illustrious","imaginary","imaginative","immaculate","immaterial","immediate","immense","impartial","impassioned","impeccable","imperfect","imperturbable","impish","impolite","important","impossible","impractical","impressionable","impressive","improbable","impure","inborn","incomparable","incompatible","incomplete","inconsequential","incredible","indelible","indolent","inexperienced","infamous","infantile","infatuated","inferior","infinite","informal","innocent","insecure","insidious","insignificant","insistent","instructive","insubstantial","intelligent","intent","intentional","interesting","internal","international","intrepid","ironclad","irresponsible","irritating","itchy","jaded","jagged","jaunty","jealous","jittery","joint","jolly","jovial","joyful","joyous","jubilant","judicious","juicy","jumbo","jumpy","junior","juvenile","kaleidoscopic","keen","key","kickass","kind","kindhearted","kindly","klutzy","knobby","knotty","knowing","knowledgeable","known","kooky","kosher","kryptonian","lame","lanky","large","last","lasting","late","laudable","lavish","lawful","lazy","leading","leafy","lean","left","legal","legendary","legitimate","light","lighthearted","likable","likely","limited","limp","limping","linear","lined","liquid","little","live","lively","livid","loathsome","lone","lonely","long","loose","lopsided","lost","loud","lovable","lovely","loving","low","loyal","lucky","lumbering","luminous","lumpy","lustrous","luxurious","mad","magnificent","majestic","major","male","mammoth","married","marvelous","masculine","massive","mathematical","mature","meager","mealy","mean","measly","meaty","medical","mediocre","medium","meek","mellow","melodic","memorable","menacing","merry","messy","metallic","mild","milky","mindless","miniature","minor","minty","miserable","miserly","misguided","misty","mixed","modern","modest","moist","monstrous","monthly","monumental","moral","mortified","motherly","motionless","mountainous","muddy","muffled","multicolored","mundane","murky","mushy","musty","muted","mysterious","naive","narrow","nasty","natural","naughty","nautical","near","neat","necessary","needy","negative","neglected","negligible","neighboring","nervous","new","next","nice","nifty","nimble","nippy","nocturnal","noisy","nonstop","normal","notable","noted","noteworthy","novel","noxious","numb","nutritious","nutty","obedient","obese","oblong","obvious","occasional","odd","oddball","offbeat","offensive","official","oily","old","only","open","optimal","optimistic","opulent","orange","orderly","ordinary","organic","original","ornate","ornery","other","our","outgoing","outlandish","outlying","outrageous","outstanding","oval","overcooked","overdue","overjoyed","overlooked","palatable","pale","paltry","parallel","parched","partial","passionate","past","pastel","peaceful","peachy","peppery","perfect","perfumed","periodic","perky","personal","pertinent","pesky","pessimistic","petty","phenomenal","phony","physical","piercing","pink","pioneering","pitiful","plain","plaintive","plastic","playful","pleasant","pleased","pleasing","plump","plush","pointed","pointless","poised","polished","polite","political","poor","popular","portly","posh","positive","possible","potable","powerful","powerless","practical","praiseworthy","precious","premium","present","prestigious","pretty","previous","priceless","pricey","prickly","primary","prime","primo","pristine","private","prize","probable","productive","profitable","profuse","proper","proud","prudent","punctual","pungent","puny","pure","purple","pushy","putrid","puzzled","puzzling","quaint","qualified","quarrelsome","quarterly","queasy","querulous","questionable","quick","quiet","quintessential","quirky","quixotic","quizzical","rad","radiant","ragged","rapid","rare","rash","raw","ready","real","realistic","reasonable","recent","reckless","rectangular","red","reflecting","regal","regular","reliable","relieved","remarkable","remorseful","remote","repentant","repulsive","required","respectful","responsible","revolving","rewarding","rich","right","rigid","ringed","ripe","riveting","roasted","robust","rosy","rotating","rotten","rough","round","rowdy","royal","rubbery","ruddy","rude","rundown","runny","rural","rusty","sad","safe","salty","same","sandy","sane","sarcastic","sardonic","satisfied","scaly","scarce","scared","scary","scented","scholarly","scientific","scornful","scratchy","scrawny","scrumtrulescent","second","secondary","secret","selfish","sensational","sentimental","separate","serene","serious","serpentine","several","severe","shabby","shadowy","shady","shallow","shameful","shameless","sharp","shimmering","shining","shiny","shocked","shocking","shoddy","short","showy","shrill","shy","sick","silent","silky","silly","silver","similar","simple","simplistic","sinful","single","sizzling","skeletal","skinny","sleepy","slick","slight","slim","slimy","slippery","slow","slushy","small","smart","smashing","smoggy","smooth","smug","snappy","snarling","sneaky","sniveling","snoopy","sociable","soft","soggy","solid","somber","some","sophisticated","sore","sorrowful","soulful","soupy","sour","spanish","sparkling","sparse","specific","spectacular","speedy","spherical","spicy","spiffy","spirited","spiteful","splendid","splendiferous","spotless","spotted","spry","square","squeaky","squiggly","stable","staid","stained","stale","standard","starchy","stark","starry","steel","steep","stellar","sticky","stiff","stimulating","stingy","stormy","straight","strange","strict","strident","striking","striped","strong","studious","stunning","stupendous","stupid","sturdy","stylish","subdued","sublime","submissive","substantial","subtle","suburban","sudden","sugary","sunny","super","superb","superficial","superior","supportive","supreme","surprised","suspicious","svelte","sweaty","sweet","swell","sweltering","swift","sympathetic","talkative","tall","tame","tan","tangible","tart","tasty","tattered","taut","tedious","teeming","tempting","tender","tense","tepid","terrible","terrific","testy","thankful","that","these","thick","thin","third","thirsty","this","thorny","thorough","those","thoughtful","threadbare","thrifty","thunderous","tidy","tight","timely","tinted","tiny","tiptop","tired","torn","total","tough","tragic","trained","transcendent","traumatic","treasured","tremendous","triangular","tricky","trifling","trim","trivial","troubled","true","trusting","trustworthy","trusty","truthful","tubby","turbulent","twin","ugly","ultimate","unacceptable","unaware","uncomfortable","uncommon","unconscious","understated","unequaled","uneven","unfinished","unfit","unfolded","unfortunate","unhappy","unhealthy","uniform","unimportant","unique","united","unkempt","unknown","unlawful","unlined","unlucky","unnatural","unpleasant","unreal","unrealistic","unripe","unruly","unselfish","unsightly","unsteady","unsung","untidy","untimely","untried","untrue","unused","unusual","unwelcome","unwieldy","unwilling","unwitting","unwritten","upbeat","upright","upset","urban","usable","used","useful","useless","utilized","utter","vacant","vague","vain","valid","valuable","vapid","variable","vast","velvety","venerated","vengeful","verifiable","vibrant","vicious","victorious","vigilant","vigorous","villainous","violent","violet","virtual","virtuous","visible","vital","vivacious","vivid","voluminous","wan","warlike","warm","warmhearted","warped","wary","wasteful"],H=["Aardvark","Aardwolf","African","Buffalo","African","Elephant","African","Leopard","Albatross","Alligator","Alpaca","American","Buffalo","American","Robin","Amphibian","Anaconda","Angelfish","Anglerfish","Ant","Anteater","Antelope","Antlion","Ape","Aphid","Arabian","Leopard","Arctic","Fox","Arctic","Wolf","Armadillo","Arrow","Crab","Asp","Ass","Baboon","Bactrian","Camel","Badger","Bald","Eagle","Bali","Cattle","Bandicoot","Barnacle","Barracuda","Basilisk","Bass","Bat","Beaked","Whale","Bear","Beaver","Bedbug","Bee","Beetle","Bird","Bison","Black","Panther","Black","Widow","Spider","Blackbird","Blue","Bird","Blue","Jay","Blue","Whale","Boa","Boar","Bobcat","Bobolink","Bonobo","Booby","Bovid","Box","Jellyfish","Bug","Butterfly","Buzzard","Camel","Canary","Canid","Canidae","Cape","Buffalo","Capybara","Cardinal","Caribou","Carp","Cat","Caterpillar","Catfish","Catshark","Cattle","Centipede","Cephalopod","Chameleon","Cheetah","Chickadee","Chicken","Chicken","Breeds","Chimpanzee","Chinchilla","Chipmunk","Cicada","Clam","Clownfish","Cobra","Cockroach","Cod","Condor","Constrictor","Coral","Cougar","Cow","Coyote","Crab","Crane","Crane","Fly","Crawdad","Crayfish","Cricket","Crocodile","Crow","Cuckoo","Damselfly","Deer","Dingo","Dinosaur","Dog","Dolphin","Donkey","Dormouse","Dove","Dragon","Dragonfly","Dromedary","Camel","Duck","Dung","Beetle","Eagle","Earthworm","Earwig","Echidna","Eel","Egret","Elephant","Elephant","Seal","Elk","Emu","English","Pointer","Ermine","Falcon","Fancy","Mouse","Fancy","Rat","Fancy","Rat","Varieties","Felidae","Ferret","Finch","Firefly","Fish","Flamingo","Flea","Fly","Flyingfish","Fowl","Fox","Frog","Fruit","Bat","Galliform","Gamefowl","Gayal","Gazelle","Gecko","Gerbil","Giant","Panda","Giant","Squid","Gibbon","Gila","Monster","Giraffe","Goat","Goldfish","Goose","Gopher","Gorilla","Grasshopper","Great","Blue","Heron","Great","White","Shark","Grizzly","Bear","Ground","Shark","Ground","Sloth","Grouse","Guan","Guanaco","Guinea","Pig","Guineafowl","Gull","Guppy","Haddock","Halibut","Hammerhead","Shark","Hamster","Hare","Harrier","Hawk","Hedgehog","Hermit","Crab","Heron","Herring","Hippopotamus","Hookworm","Hornet","Horse","Hoverfly","Hummingbird","Humpback","Whale","Hyena","Iguana","Impala","Irukandji","Jellyfish","Jackal","Jaguar","Jay","Jellyfish","Junglefowl","Kangaroo","Kangaroo","Mouse","Kangaroo","Rat","Kingfisher","Kite","Kiwi","Koala","Koi","Komodo","Dragon","Krill","Lab","Rat","Ladybug","Lamprey","Land","Snail","Landfowl","Lark","Leech","Lemming","Lemur","Leopard","Leopon","Limpet","Lion","Lizard","Llama","Lobster","Locust","Loon","Louse","Lungfish","Lynx","Macaw","Mackerel","Magpie","Mammal","Manatee","Mandrill","Manta","Ray","Marlin","Marmoset","Marmot","Marsupial","Marten","Mastodon","Meadowlark","Meerkat","Mink","Minnow","Mite","Mockingbird","Mole","Mollusk","Mongoose","Monitor","Lizard","Monkey","Moose","Mosquito","Moth","Mountain","Goat","Mouse","Mule","Muskox","Narwhal","World","Quail","Newt","Nightingale","Ocelot","Octopus","Old","World","Quail","Opossum","Orangutan","Orca","Ostrich","Otter","Owl","Ox","Panda","Panther","Panthera","Hybrid","Parakeet","Parrot","Parrotfish","Partridge","Peacock","Peafowl","Pelican","Penguin","Perch","Peregrine","Falcon","Pheasant","Pig","Pigeon","Pike","Pilot","Whale","Pinniped","Piranha","Planarian","Platypus","Polar","Bear","Pony","Porcupine","Porpoise","Portuguese","Man","O'","War","Possum","Prairie","Dog","Prawn","Praying","Mantis","Primate","Ptarmigan","Puffin","Puma","Python","Quail","Quelea","Quokka","Rabbit","Raccoon","Rainbow","Trout","Rat","Rattlesnake","Raven","Ray","Red","Panda","Reindeer","Reptile","Rhinoceros","Right","Whale","Ringneck","Dove","Roadrunner","Rodent","Rook","Rooster","Roundworm","Saber-toothed","Cat","Sailfish","Salamander","Salmon","Sawfish","Scale","Insect","Scallop","Scorpion","Sea","Lion","Sea","Slug","Sea","Snail","Seahorse","Shark","Sheep","Shrew","Shrimp","Siamese","Fighting","Fish","Silkmoth","Silkworm","Silver","Fox","Silverfish","Skink","Skunk","Sloth","Slug","Smelt","Snail","Snake","Snipe","Snow","Leopard","Society","Finch","Sockeye","Salmon","Sole","Sparrow","Sperm","Whale","Spider","Spider","Monkey","Spoonbill","Squid","Squirrel","Star-nosed","Mole","Starfish","Steelhead","Trout","Stingray","Stoat","Stork","Sturgeon","Sugar","Glider","Swallow","Swan","Swift","Swordfish","Swordtail","Tahr","Takin","Tapir","Tarantula","Tarsier","Tasmanian","Devil","Termite","Tern","Thrush","Tick","Tiger","Tiger","Shark","Tiglon","Toad","Tortoise","Toucan","Trapdoor","Spider","Tree","Frog","Trout","Tuna","Turkey","Turkey","Breeds","Turtle","Tyrannosaurus","Urial","Vampire","Bat","Vampire","Squid","Vicuna","Viper","Vole","Vulture","Wallaby","Walrus","Warbler","Wasp","Water","Boa","Water","Buffalo","Weasel","Whale","Whippet","Whitefish","Whooping","Crane","Wildcat","Wildebeest","Wildfowl","Wolf","Wolverine","Wombat","Woodpecker","Worm","Wren","X-ray","Fish","Xerinae","Yak","Yellow","Perch","Zebra","Zebra","Finch"];var O=i(2909).Buffer;let X="/chess/matchmaking/0.0.1",N="findgame",K=["pubXXX-dev"];function J(){let[e,a]=(0,l.useState)(null),[i,r]=(0,l.useState)(null),[J,_]=(0,l.useState)(null),[V,Z]=(0,l.useState)(null),[Q,U]=(0,l.useState)(null),[$,Y]=(0,l.useState)(""),[ee,ea]=(0,l.useState)(null),[ei,et]=(0,l.useState)(null),[er,en]=(0,l.useState)(null),[el,eo]=(0,l.useState)(""),[es,eu]=(0,l.useState)(null),[ec,ed]=(0,l.useState)([]),[eg,eh]=(0,l.useState)(null),[em,ep]=(0,l.useState)([]),ef=(0,l.useMemo)(()=>new j.d$,[]),[ey,eb]=(0,l.useState)(ef.fen()),[ew,ev]=(0,l.useState)(!1),[ek,ex]=(0,l.useState)(!1),[eS,ej]=(0,l.useState)("not connected"),[eC,eP]=(0,l.useState)(null),[eM,eB]=(0,l.useState)(null),[eW,eE]=(0,l.useState)("white"),[eF,eA]=(0,l.useState)("white"),[eD,ez]=(0,l.useState)(180),[eT,eL]=(0,l.useState)(180),[eG,eq]=(0,l.useState)(null),[eI,eR]=(0,l.useState)(null),[eH,eO]=(0,l.useState)(null);(0,l.useEffect)(()=>{let e=[{provider:new o.k(window.ethereum,0xaa36a7),chainId:"11155111"}],a=new w.D7({networks:e}),i=[{type:"walletBalance",chainId:"11155111",params:{value:s.g5("0"),compareType:"gte"}}],t=(0,w.I0)(e,i);a.addRules(t),eO(a)},[]);let eX=async()=>{if(null==e)throw Error("provider is not set");try{let a=await e.send("eth_requestAccounts",[]);U(a[0]),console.log("set account",a[0])}catch(e){console.log("user rejected request",e.message)}},eN=async()=>{if(null==e)throw Error("provider is not set");let a=await e.getSigner(),t=await a.getAddress(),r=function(e,a){if(null===i||null===J||null===V)throw Error("scheme, domain, or origin is not set");return new S.SiweMessage({scheme:i,domain:J,address:e,statement:a,uri:V,version:"1",chainId:31337}).prepareMessage()}(a.address,"Sign in with Ethereum to the app.");try{let e=await a.signMessage(r);ea(e),console.log("siwe signature",e);let{dWallet:i,signerSigAttest:n}=await eK(e);return{dWallet:i,signerAddress:t,signerSigAttest:n}}catch(e){throw console.log(e.message),e}},eK=async a=>{if(null==e)throw Error("provider is not set");let i=await e.getSigner(),t=(0,u.id)(a),r=new c.u(t,e),n=await r.getAddress();et(r),en(n);let l="Attestation\r\n".concat(n," is my ").concat(J," wallet."),o=await i.signMessage(l);return eu(o),{dWallet:r,signerSigAttest:o}},eJ=async()=>{try{await eX();let{dWallet:e,signerAddress:a,signerSigAttest:i}=await eN();if(null==e)throw Error("dWallet is empty");if(null==a||""===a)throw Error("signerAddress is empty");if(null==i||""===i)throw Error("signerSigAtter is empty");await e$(e,a,i)}catch(e){console.log(e)}},e_=async()=>{try{ef.reset(),ev(!1),ex(!1),ej("not connected"),U(null),et(null),en(null),eP(null),eR(null),await (null==eg?void 0:eg.stop()),eh(null)}catch(e){console.log(e)}};(0,l.useEffect)(()=>{if(!eg||!ew)return;try{eg.services.pubsub.publish("pubXXX-dev",O.from(N))}catch(e){console.error("publish error",e)}let e=setInterval(()=>{try{eg.services.pubsub.publish("pubXXX-dev",O.from(N))}catch(e){console.error("publish error",e)}},3e3);return()=>{clearInterval(e)}},[ew,eg]);let eV=e=>1200*("12D3KooWLnnFfJxesZZN4wWKNxAudd9atnBnvWPhxg2LTWigExPP"===e||"12D3KooWHEXu2JRgq7BKa7x4ahmjhiG5XZ2bUHF1Dcy56ueCXw48"===e),eZ=e=>e,eQ=e=>{let{stream:a,connection:i}=e;if(eC){i.abort(Error("already playing"));return}console.log("handleMatchmaking",a,i),ev(!1),ej("connected"),eP((0,L.V)(a)),eB(i),console.log("setting opponent in handleMatchmaking",null==eg?void 0:eg.services.evmMiddleware.getAccountForConnection(i)),eq(null==eg?void 0:eg.services.evmMiddleware.getAccountForConnection(i)),"outbound"===a.direction?(eE("white"),eA("black")):(eE("black"),eA("white")),ef.reset(),ex(!0),ez(180),eL(180)},eU=(0,l.useCallback)(async e=>{if(!K.includes(e.detail.topic)){console.log("unknown topic",e.detail.topic);return}let a=(0,T.dI)(e.detail.data);if(a===N){if(ew){console.log("handlePubsubMessageEvent finding game"),ev(!1),ej("connecting");try{console.log("dialing",e.detail.from.toString());let a=await (null==eg?void 0:eg.dial(e.detail.from,{signal:AbortSignal.timeout(5e3)}));if(!a)throw Error("conn is null");let i=await a.newStream(X,{signal:AbortSignal.timeout(5e3)});if(!i)throw Error("stream is null");ej("connected"),"outbound"===i.direction?(eE("white"),eA("black")):(eE("black"),eA("white")),console.log("setting opponent in FIND_GAME",null==eg?void 0:eg.services.evmMiddleware.getAccountForConnection(a)),eq(null==eg?void 0:eg.services.evmMiddleware.getAccountForConnection(a));let t=(0,L.V)(i);eP(t),ef.reset(),ex(!0),ez(180),eL(180)}catch(e){ev(!0),ej("not connected"),ex(!1),console.log(e)}}}else console.log("unknown command",a)},[eg,ew]),e$=async(e,a,i)=>{if(null==e)throw Error("derivedWallet is not set");if(!i)throw Error("attestation is not set");let t=await (0,g.E)({addresses:{listen:["/p2p-circuit","/webrtc"]},peerDiscovery:[(0,v.N)({list:["/dns4/r1.dozy.io/tcp/443/tls/ws/p2p/12D3KooWHEXu2JRgq7BKa7x4ahmjhiG5XZ2bUHF1Dcy56ueCXw48","/dns4/r2.dozy.io/tcp/443/tls/ws/p2p/12D3KooWLnnFfJxesZZN4wWKNxAudd9atnBnvWPhxg2LTWigExPP"]})],transports:[(0,x.h)({filter:k.Q7}),(0,d.c)(),(0,m.y)({})],connectionEncrypters:[(0,h.f)()],streamMuxers:[(0,y.N)()],services:{identify:(0,p.l)(),identifyPush:(0,p.d)(),metrics:(0,q.tD)(),ping:(0,f.h)(),dht:(0,z.dU)({protocol:"/pubxxx-dev/kad/1.0.0",kBucketSize:20,peerInfoMapper:eZ,clientMode:!1}),pubsub:(0,D.KF)({D:8,Dlo:6,Dhi:12,Dout:2,doPX:!1,emitSelf:!1,globalSignaturePolicy:"StrictSign",allowPublishToZeroTopicPeers:!0,pruneBackoff:6e4,scoreParams:(0,A.h5)({appSpecificScore:eV,IPColocationFactorWeight:0,IPColocationFactorThreshold:0,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:0,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:0,topicScoreCap:50,topics:K.reduce((e,a)=>(e[a]=(0,A.Go)({topicWeight:1,timeInMeshWeight:.1,timeInMeshQuantum:1e3,timeInMeshCap:3,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.9,firstMessageDeliveriesCap:5,meshMessageDeliveriesWeight:0,meshFailurePenaltyWeight:0,invalidMessageDeliveriesWeight:0}),e),{})}),scoreThresholds:{gossipThreshold:500,publishThreshold:-1e3,graylistThreshold:-2500,acceptPXThreshold:1e3,opportunisticGraftThreshold:3.5}}),evmMiddleware:(0,b.Z)({signer:e,withAttestation:!0,attestationDomain:J,attestationSignerAddress:null!=a?a:"",attestationSignature:null!=i?i:"",evmRuleEngine:eH,runOnLimitedConnection:!0,maxInboundStreams:10,maxOutboundStreams:10})}});await t.start(),t.use(X,async(e,a,i)=>{if(console.log(X,"evm-middleware: securing protocol"),"outbound"===a.direction){if(console.log(X,"evm-middleware: securing outbound"),!1===await t.services.evmMiddleware.decorate(e,a)){console.log(X,"evm-middleware: Failed to authenticate (outbound)");return}}else if(console.log(X,"evm-middleware: securing inbound"),!1===await t.services.evmMiddleware.decorate(e,a)){console.log("evm-middlewate: Failed to authenticate (inbound)");return}i(e,a)}),t.services.dht.setMode("server",{force:!0}),console.log("Node started with id ".concat(t.peerId.toString())),console.log("Mutliaddrs",t.getMultiaddrs()),console.log("Protocols",t.getProtocols()),t.addEventListener("self:peer:update",e=>{console.log("self peer update",t.getMultiaddrs()),ed(t.getMultiaddrs())}),t.handle(X,eQ),eh(t)};(0,l.useEffect)(()=>{if(eg)return K.forEach(e=>eg.services.pubsub.subscribe(e)),eg.services.pubsub.addEventListener("message",eU),()=>{eg&&(eg.services.pubsub.removeEventListener("message",eU),eg.services.pubsub&&eg.services.pubsub.started&&K.forEach(e=>eg.services.pubsub.unsubscribe(e)))}},[eg,K,eU]),(0,l.useEffect)(()=>{window.ethereum&&(a(new o.k(window.ethereum)),r(window.location.protocol.slice(0,-1)),_(window.location.host),Z(window.location.origin))},[]);let eY=(0,l.useMemo)(()=>{let e=ef.turn();return"w"===e&&"white"===eW||"b"===e&&"black"===eW},[ef,ey,eW]),e0=e=>{let a=Math.floor(Math.max(e,0)/60).toString().padStart(2,"0"),i=(Math.max(e,0)%60).toString().padStart(2,"0");return"".concat(a,":").concat(i)};(0,l.useEffect)(()=>{if(!ek)return;let e=setInterval(()=>{!ef.isGameOver()&&("w"===ef.turn()?(ez(e=>e-1),eD<=1&&ej("black win")):(eL(e=>e-1),eT<=1&&ej("white win")))},1e3);return()=>clearInterval(e)},[ek,ey,eD,eT]),(0,l.useEffect)(()=>{(ej("w"===ef.turn()?"white move":"black move"),ef.isCheckmate())?"white"==("white"==("w"===ef.turn()?"white":"black")?"black":"white")?ej("white win"):ej("black win"):ef.isCheck()?ej("check"):ef.isStalemate()?ej("stalemate"):ef.isThreefoldRepetition()?ej("threefold repetition"):ef.isInsufficientMaterial()?ej("insufficient material"):ef.isDraw()&&ej("draw")},[ey]);let e1=(0,P.A)({base:240,sm:320,md:400,lg:650}),e3=()=>{if(eg)for(let e of eg.services.pubsub.getPeers().map(e=>e.toString()))console.log(e,eg.services.pubsub.getScore(e))},e2=e=>{if(null===e)return"";let a=BigInt(e.toLowerCase()),i=Number(a%BigInt(R.length)),t=Number((a>>16n)%BigInt(H.length));return"".concat(R[i][0].toUpperCase()+R[i].slice(1)," ").concat(H[t])};(0,l.useEffect)(()=>{let e=setInterval(()=>{e3()},1e3);return()=>clearInterval(e)},[]);let e5=async e=>{if(!eC)return;let a=new TextEncoder().encode(JSON.stringify(e));try{await eC.write(a,{signal:AbortSignal.timeout(5e3)})}catch(e){eR("Could not send ovePlayer Disconnected"),console.log("error sending message",e)}};return(0,l.useEffect)(()=>{if(!eC)return;let e=!0;return(async()=>{for(;e;)try{let e;let a=await eC.read();if(!a)break;try{let i=a.subarray(),t=new TextDecoder().decode(i);e=JSON.parse(t)}catch(e){console.error("invalid game message",e);continue}switch(e.type){case"move":ef.move(e.payload);break;case"fen":break;default:console.log("unknown game message",e)}eb(ef.fen())}catch(e){eR("".concat(eF," Disconnected")),ej("not connected"),eP(null),console.log("error reading game stream",e);return}})(),()=>{e=!1}},[eC]),(0,l.useEffect)(()=>{let a=setInterval(async()=>{if(null!=e&&null!=Q&&null!=er){try{let a=await e.getBalance(Q);Y(s.ck(a))}catch(e){console.log("account getBalance error",e.message)}try{let a=await e.getBalance(er);eo(s.ck(a))}catch(e){console.log("derived account getBalance error",e.message)}}},1e3);return()=>{clearInterval(a)}},[Q,er,e]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n(),{children:[(0,t.jsx)("title",{children:"Chess P2P"}),(0,t.jsx)("meta",{name:"description",content:"Chess P2P"}),(0,t.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,t.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("main",{children:[(0,t.jsxs)(M.s,{bg:"#f9e5b8",justify:"space-between",py:"1",px:"3",children:[(0,t.jsx)(B.a,{children:(0,t.jsxs)(M.s,{children:[(0,t.jsx)("img",{src:"/p2p-chess-min.png",style:{height:"40px"}}),(0,t.jsx)(B.a,{color:"#000",fontWeight:"bold",fontSize:"28px",children:"P2P Chess"})]})}),(0,t.jsxs)(B.a,{textAlign:"right",children:[!er&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(W.$,{onClick:eJ,px:"2",children:"Log In"})}),er&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(W.$,{onClick:e_,px:"2",children:"Log Out"})})]})]}),(0,t.jsxs)(M.s,{direction:{base:"column",md:"row"},minH:"100vh",children:[(0,t.jsx)(B.a,{flex:{base:"1 1 auto",md:"2 1 0%"},minW:0,bg:"#f9e5b8",children:(0,t.jsx)(B.a,{children:(0,t.jsxs)(E.o,{children:[eg&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(B.a,{children:[(0,t.jsx)(B.a,{color:"black",textAlign:"right",bg:"gray.300",p:"2",children:(0,t.jsxs)(M.s,{justify:"space-between",children:[(0,t.jsx)(B.a,{children:eG&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(M.s,{children:[(0,t.jsx)(I.A,{seed:eG.toLowerCase(),size:10,scale:5}),(0,t.jsxs)(B.a,{px:"1",textAlign:"left",children:[(0,t.jsx)(B.a,{children:e2(eG)}),(0,t.jsxs)(B.a,{children:[eG.slice(0,7),"...",eG.slice(-5)]})]})]})})}),(0,t.jsxs)(B.a,{children:["black"===eW&&e0(eD),"white"===eW&&e0(eT)]})]})}),(0,t.jsx)(C.Ve,{boardWidth:e1,position:ef.fen(),onPieceDrop:function(e,a,i){let t;if(eD<=0||eT<=0||!eY)return!1;try{var r;if(t=ef.move({from:e,to:a,promotion:null!==(r=i[1].toLowerCase())&&void 0!==r?r:"q"}),null===t)return!1;return eb(ef.fen()),e5({type:"move",payload:t}),!0}catch(e){return console.log("illegal move",e),!1}},autoPromoteToQueen:!0,boardOrientation:eW,arePiecesDraggable:eY&&eD>0&&eT>0}),(0,t.jsx)(B.a,{color:"black",textAlign:"right",bg:"gray.300",p:"2",children:(0,t.jsxs)(M.s,{justify:"space-between",children:[(0,t.jsx)(B.a,{children:Q&&(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)(M.s,{children:[(0,t.jsx)(I.A,{seed:Q.toLowerCase(),size:10,scale:5}),(0,t.jsxs)(B.a,{px:"1",textAlign:"left",children:[(0,t.jsx)(B.a,{children:e2(Q)}),(0,t.jsxs)(B.a,{children:[Q.slice(0,7),"...",Q.slice(-5)]})]})]})})}),(0,t.jsxs)(B.a,{children:["black"===eW&&e0(eT),"white"===eW&&e0(eD)]})]})}),(0,t.jsx)(B.a,{color:"black",children:eI})]})}),!eg&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)("img",{src:"/p2p-chess-min.png"})})]})})}),(0,t.jsxs)(B.a,{flex:{base:"1 1 auto",md:"0 0 33.3333%"},minW:0,bg:"gray.800",p:4,children:[!eg&&!er&&(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(E.o,{children:(0,t.jsxs)(W.$,{onClick:eJ,px:"2",children:[(0,t.jsx)(G.liQ,{})," Sign in with Ethereum"]})})}),eg&&er&&(0,t.jsxs)(t.Fragment,{children:[!eC&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(W.$,{px:"2",onClick:()=>{eR(""),ev(!ew)},children:[ew&&(0,t.jsxs)(t.Fragment,{children:["Finding Opponent ",(0,t.jsx)(F.y,{})]}),!ew&&(0,t.jsx)(t.Fragment,{children:"Play Online"})]}),(0,t.jsxs)(B.a,{children:["Account Balance: ",$]}),(0,t.jsxs)(B.a,{children:["Derived Wallet Balance: ",el]})]}),eC&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(B.a,{children:[(0,t.jsxs)(B.a,{children:["Game Status: ",eD<=0?"Black wins on time":eT<=0?"White wins on time":eS]}),(0,t.jsxs)(B.a,{children:["Playing as: ",eW]})]}),(0,t.jsxs)(B.a,{children:["Moves",(0,t.jsx)("ol",{children:ef.history().map((e,a)=>(0,t.jsx)("li",{children:e},e+a))})]})]}),(0,t.jsxs)(B.a,{children:[(0,t.jsxs)(B.a,{children:["Account: ",Q]}),(0,t.jsxs)(B.a,{children:["Derived wallet address: ",er]})]}),(0,t.jsxs)(B.a,{children:["Peer ID: ",null==eg?void 0:eg.peerId.toString()]})]})]})]})]}),(0,t.jsx)("footer",{})]})]})}},6760:(e,a,i)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return i(858)}])},9432:()=>{}},e=>{var a=a=>e(e.s=a);e.O(0,[938,774,701,636,593,792],()=>a(6760)),_N_E=e.O()}]);